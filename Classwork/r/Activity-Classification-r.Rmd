---
title: "Classification with KNN and Logistic Regression"
author: "YOUR NAME HERE"
output: html_document
# Warning:  File created automatically
# Do NOT edit this file directly, as it may be overwritten.
---

```{r, include = FALSE}
```

```{r setup, include=FALSE}
library(tidyverse)
library(tidymodels)
library(kknn)
library(glmnet)
```

## KNN

#### Code from Lecture

```{r, message = FALSE}
ins <- read_csv("https://www.dropbox.com/s/bocjjyo1ehr5auz/insurance.csv?dl=1")
head(ins)
```

```{r}
knn_mod <- nearest_neighbor(neighbors = 5) %>%
  set_engine("kknn") %>%
  set_mode("classification")
```

```{r}
ins <- ins %>%
  mutate(
    smoker = factor(smoker)
  ) %>%
  drop_na()
```

```{r}
knn_fit_1 <- knn_mod %>%
  fit(smoker ~ charges, data = ins)

knn_fit_1$fit %>% summary()
```

#### Your tasks

Select the best KNN model for predicting smoker status
What metrics does the cross-validation process automatically output?

## Logistic Regression

#### Code from lecture:

```{r}
logit_mod <- logistic_reg() %>%
  set_mode("classification") %>%
  set_engine("glm")
```

```{r}
ins_rec <- recipe(smoker ~ charges, data = ins) %>%
  step_normalize(all_numeric())
```

```{r}
ins_wflow_logit <- workflow() %>%
  add_recipe(ins_rec) %>%
  add_model(logit_mod)

ins_fit <- ins_wflow_logit %>%
  fit(ins)

ins_fit %>% pull_workflow_fit()
```

```{r}
preds <- ins_fit %>% predict(ins)
preds
```

```{r}
ins_fit %>% predict(ins, type = "raw")
```

```{r}
ins_fit %>% predict(ins, type = "prob")
```

```{r}
pred_probs = ins_fit %>% predict(ins, type = "prob")

ins %>%
  mutate(
    pred_probs = pred_probs$.pred_yes
  ) %>%
  ggplot(aes(y = pred_probs, x = charges, color = smoker)) +
  geom_point()
```

```{r}
preds <- ins_fit %>% predict(ins)

ins <- ins %>%
  mutate(
    predicted_smoker = preds$.pred_class
  ) 

ins %>% count(predicted_smoker, smoker)
```

What percentage did we get correct?

```{r}
ins %>%
  mutate(
    correct = (predicted_smoker == smoker)
  ) %>%
  count(correct) %>%
  mutate(
    pct = n/sum(n)
  )
```

```{r}
ins %>%
  accuracy(truth = smoker,
           estimate = predicted_smoker)
```

#### Your tasks

Select the best logistic regression model for predicting smoker status
Report the cross-validated metrics - how do they compare to KNN?

